{
  "name": "Spirit Guardians v4",
  "type": "spell",
  "img": "icons/magic/light/projectile-bolts-salvo-white.webp",
  "effects": [
    {
      "_id": "kJdmHhTJH03zJxo2",
      "changes": [
        {
          "key": "system.attributes.movement.all",
          "mode": 0,
          "value": "/2",
          "priority": 20
        },
        {
          "key": "flags.midi-qol.OverTime",
          "mode": 5,
          "value": "turn=start,\nlabel=Spirit  Guardians,\ndamageRoll=(@spellLevel)d8,\ndamageType=radiant,\nsaveRemove=false,\nsaveDC=@attributes.spelldc,\nsaveAbility=wis,\nsaveDamage=halfdamage,\nkillAnim=true",
          "priority": 20
        },
        {
          "key": "macro.itemMacro",
          "mode": 0,
          "value": "@token @spellLevel @attributes.spelldc",
          "priority": 20
        }
      ],
      "disabled": false,
      "duration": {
        "startTime": null,
        "seconds": null,
        "combat": null,
        "rounds": null,
        "turns": null,
        "startRound": null,
        "startTurn": null
      },
      "origin": "Item.LTQm45DD4V2IqDpi",
      "transfer": false,
      "flags": {
        "dae": {
          "stackable": "none",
          "macroRepeat": "none",
          "specialDuration": [],
          "transfer": false
        },
        "dnd5e-helpers": {
          "rest-effect": "Ignore"
        },
        "ActiveAuras": {
          "isAura": true,
          "aura": "Enemy",
          "radius": 15,
          "alignment": "",
          "type": "",
          "ignoreSelf": true,
          "height": false,
          "hidden": false,
          "hostile": false,
          "onlyOnce": false
        }
      },
      "tint": "#ffffff",
      "name": "Spirit Guardians",
      "description": "",
      "statuses": [],
      "_stats": {
        "compendiumSource": null,
        "duplicateSource": null,
        "coreVersion": "12.331",
        "systemId": "dnd5e",
        "systemVersion": "4.1.2",
        "createdTime": null,
        "modifiedTime": null,
        "lastModifiedBy": null
      },
      "img": "icons/magic/light/projectile-bolts-salvo-white.webp",
      "type": "base",
      "system": {},
      "sort": 0,
      "_key": "!items.effects!cQRmwQcPULIjCach.kJdmHhTJH03zJxo2"
    }
  ],
  "flags": {
    "core": {
      "sourceId": "Compendium.dnd5e.spells.uCud2s4TjMfjiXUb"
    },
    "midi-qol": {
      "onUseMacroName": "",
      "effectActivation": false,
      "rollAttackPerTarget": "default",
      "itemCondition": "",
      "reactionCondition": "",
      "otherCondition": "",
      "effectCondition": ""
    },
    "betterRolls5e": {
      "quickOther": {
        "context": "",
        "value": true,
        "altValue": true,
        "type": "Boolean"
      },
      "quickDesc": {
        "value": true,
        "altValue": true,
        "type": "Boolean"
      },
      "quickSave": {
        "value": true,
        "altValue": true,
        "type": "Boolean"
      },
      "quickProperties": {
        "value": true,
        "altValue": true,
        "type": "Boolean"
      },
      "quickVersatile": {
        "value": false,
        "altValue": false,
        "type": "Boolean"
      },
      "quickFlavor": {
        "value": true,
        "altValue": true,
        "type": "Boolean"
      },
      "quickAttack": {
        "type": "Boolean",
        "value": true,
        "altValue": true
      },
      "quickDamage": {
        "type": "Array",
        "value": [],
        "altValue": [],
        "context": []
      },
      "quickCharges": {
        "type": "Boolean",
        "value": {
          "use": true,
          "resource": true
        },
        "altValue": {
          "use": true,
          "resource": true
        }
      },
      "quickTemplate": {
        "type": "Boolean",
        "value": true,
        "altValue": true
      },
      "quickPrompt": {
        "type": "Boolean",
        "value": false,
        "altValue": false
      }
    },
    "scene-packer": {
      "hash": "5517dcc2725d9c3f9845b639608127534ede5c37",
      "sourceId": "Item.B8IrEtWEU0h9EtqY"
    },
    "itemacro": {
      "macro": {
        "data": {
          "_id": null,
          "name": "Spirit Guardians 0.8.85",
          "type": "script",
          "author": "devnIbfBHb74U9Zv",
          "img": "icons/svg/dice-target.svg",
          "scope": "global",
          "command": "const lastArg = args[args.length -1];\n// Check when applying the effect - if the token is not the caster and it IS the tokens turn they take damage\nif (args[0] === \"on\" && args[1] !== lastArg.tokenId && lastArg.tokenId === game.combat?.current.tokenId) {\n    const sourceItem = await fromUuid(lastArg.origin);\n    let theActor = await fromUuid(lastArg.actorUuid);\n    if (theActor.actor) theActor = theActor.actor;\n    const itemData = mergeObject(duplicate(sourceItem.data), {\n        type: \"weapon\",\n        effects: [],\n        flags: {\n            \"midi-qol\": {\n                noProvokeReaction: true, // no reactions triggered\n                onUseMacroName: null // \n            },\n        },\n        data: {\n            actionType: \"save\",\n            save: {dc: Number.parseInt(args[3]), ability: \"wis\", scaling: \"flat\"},\n            damage: { parts: [[`${args[2]}d8`, \"radiant\"]] },\n            \"target.type\": \"self\",\n            components: {concentration: false, material: false, ritual: false, somatic: false, value: \"\", vocal: false},\n            duration: {units: \"inst\", value: undefined},\n            weaponType: \"improv\"\n        }\n    }, {overwrite: true, inlace: true, insertKeys: true, insertValues: true});\n    itemData.data.target.type = \"self\";\n    setProperty(itemData.flags, \"autoanimations.killAnim\", true);\n    itemData.flags.autoanimations.killAnim = true;;\n    const item = new CONFIG.Item.documentClass(itemData, { parent: theActor })\n    const options = { showFullCard: false, createWorkflow: true, versatile: false, configureDialog: false };\n    await MidiQOL.completeItemRoll(item, options);\n\n}",
          "folder": null,
          "sort": 0,
          "permission": {
            "default": 0
          },
          "flags": {}
        },
        "name": "Spirit Guardians 10.0.10",
        "type": "script",
        "img": "icons/svg/dice-target.svg",
        "scope": "global",
        "command": "const version = \"10.0.10\";\ntry {\n    const lastArg = args[args.length -1];\n    // Check when applying the effect - if the token is not the caster and it IS the tokens turn they take damage\n    if (args[0] === \"on\" && args[1] !== lastArg.tokenId && lastArg.tokenId === game.combat?.current.tokenId) {\n        const sourceItem = await fromUuid(lastArg.origin);\n        let theActor = await fromUuid(lastArg.actorUuid);\n        if (theActor.actor) theActor = theActor.actor;\n        const itemData = mergeObject(duplicate(sourceItem.toObject(false)), {\n            type: \"weapon\",\n            effects: [],\n            flags: {\n                \"midi-qol\": {\n                    noProvokeReaction: true, // no reactions triggered\n                    onUseMacroName: null // \n                },\n            },\n            system: {\n                actionType: \"save\",\n                save: {dc: Number.parseInt(args[3]), ability: \"wis\", scaling: \"flat\"},\n                damage: { parts: [[`${args[2]}d8`, \"radiant\"]] },\n                \"target.type\": \"self\",\n                components: {concentration: false, material: false, ritual: false, somatic: false, value: \"\", vocal: false},\n                duration: {units: \"inst\", value: undefined},\n                weaponType: \"improv\"\n            }\n        }, {overwrite: true, inlace: true, insertKeys: true, insertValues: true});\n        itemData.system.target.type = \"self\";\n        setProperty(itemData.flags, \"autoanimations.killAnim\", true);\n        itemData.flags.autoanimations.killAnim = true;;\n        const item = new CONFIG.Item.documentClass(itemData, { parent: theActor })\n        const options = { showFullCard: false, createWorkflow: true, versatile: false, configureDialog: false };\n        await MidiQOL.completeItemRoll(item, options);\n    }\n} catch (err) {\n    console.error(`Spirit Guardians ${version}`, err);\n}",
        "sort": 0,
        "ownership": {
          "default": 0
        },
        "flags": {},
        "_stats": {
          "systemId": null,
          "systemVersion": null,
          "coreVersion": null,
          "createdTime": null,
          "modifiedTime": null,
          "lastModifiedBy": null
        }
      }
    },
    "gm-notes": {},
    "cf": {
      "id": "temp_0hvf80hl1zcf",
      "color": "#000000"
    },
    "autoanimations": {
      "version": 4,
      "killAnim": false,
      "options": {
        "ammo": false
      },
      "override": false,
      "autoOverride": {
        "enable": false
      },
      "allSounds": {
        "item": {
          "enableAudio": false
        }
      },
      "sourceToken": {
        "enable": false
      },
      "targetToken": {
        "enable": false
      },
      "audio": {
        "a01": {
          "enable": false,
          "file": "",
          "delay": 0,
          "volume": 0.25
        },
        "e01": {
          "enable": false,
          "file": "",
          "delay": 0,
          "volume": 0.25
        }
      }
    },
    "dnd5e": {
      "persistSourceMigration": true,
      "migratedProperties": [
        "vocal",
        "somatic",
        "material",
        "concentration"
      ],
      "dependents": [
        {
          "uuid": "Actor.WSDm88RsLBxiViel.ActiveEffect.hzjA0XxJEgyD0OaZ"
        }
      ]
    },
    "midiProperties": {
      "confirmTargets": "default",
      "autoFailFriendly": false,
      "autoSaveFriendly": false,
      "critOther": false,
      "offHandWeapon": false,
      "magicdam": false,
      "magiceffect": false,
      "noConcentrationCheck": false,
      "toggleEffect": false,
      "ignoreTotalCover": false,
      "idr": false,
      "idi": false,
      "idv": false,
      "ida": false
    },
    "dae": {
      "macro": {
        "name": "Spirit Guardians v4",
        "img": "icons/magic/light/projectile-bolts-salvo-white.webp",
        "type": "script",
        "scope": "global",
        "command": "const version = \"12.4.7\";\ntry {\n    const lastArg = args[args.length -1];\n    // Check when applying the effect - if the token is not the caster and it IS the tokens turn they take damage\n    if (args[0] === \"on\" && args[1] !== lastArg.tokenId && lastArg.tokenId === game.combat?.current.tokenId) {\n        const sourceItem = await fromUuid(lastArg.origin);\n        let theActor = await fromUuid(lastArg.actorUuid);\n        if (theActor.actor) theActor = theActor.actor;\n        const itemData = mergeObject(foundry.utils.duplicate(sourceItem.toObject(false)), {\n            type: \"weapon\",\n            effects: [],\n            flags: {\n                \"midi-qol\": {\n                    noProvokeReaction: true, // no reactions triggered\n                    onUseMacroName: null // \n                },\n            },\n            system: {\n                activities:{\n                    \"guardians\": {\n                        id: \"guardian\",\n                        name: \"guardians\",\n                        type: \"save\",\n                        save: {ability: \"wis\", dc: {calculation: \"\", formula: `${args[3]}`}},\n                        damage: {\n                            parts: [{\n                                custom: {\n                                    enabled: true, \n                                    formula: `${args[2]}d8`\n                                },\n                                types: [\"radiant\"]\n                            }],\n                            onSave: \"half\"\n                        }, \n                        target: {affects: {type: \"self\"}},\n                    },\n                },\n                components: {concentration: false, material: false, ritual: false, somatic: false, value: \"\", vocal: false},\n                duration: {units: \"inst\", value: undefined},\n                weaponType: \"improv\"\n            },\n        }, {overwrite: true, inlace: true, insertKeys: true, insertValues: true});\n        foundry.utils.setProperty(itemData.flags, \"autoanimations.killAnim\", true);\n        itemData.flags.autoanimations.killAnim = true;\n        const item = new CONFIG.Item.documentClass(itemData, { parent: theActor });\n        item.setFlag = async (scope, ke, valu) => {return item};\n        item.prepareData();\n        item.prepareFinalAttributes();\n        item.prepareEmbeddedDocuments();\n        const options = { showFullCard: false, createWorkflow: true, versatile: false, ignoreUserTargets: true};\n        await MidiQOL.completeItemUseV2(item, {midiOptions: options}, {configure: false}, {});\n    }\n} catch (err) {\n    console.error(`Spirit Guardians ${version}`, err);\n}",
        "author": "Zl1BOUaPLwDEujaL",
        "ownership": {
          "default": 3
        },
        "_id": null,
        "folder": null,
        "sort": 0,
        "flags": {},
        "_stats": {
          "coreVersion": "12.331",
          "systemId": "dnd5e",
          "systemVersion": "4.1.1",
          "createdTime": null,
          "modifiedTime": null,
          "lastModifiedBy": null,
          "compendiumSource": null,
          "duplicateSource": null
        }
      }
    }
  },
  "system": {
    "description": {
      "value": "<p>You call forth spirits to protect you. They flit around you to a distance of 15 feet for the duration. If you are good or neutral, their spectral form appears angelic or fey (your choice). If you are evil, they appear fiendish.</p>\n<p>When you cast this spell, you can designate any number of creatures you can see to be unaffected by it. An affected creature's speed is halved in the area, and when the creature enters the area for the first time on a turn or starts its turn there, it must make a Wisdom saving throw. On a failed save, the creature takes 3d8 radiant damage (if you are good or neutral) or 3d8 necrotic damage (if you are evil). On a successful save, the creature takes half as much damage.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d8 for each slot level above 3rd.</p>\n<p>Midi-qol: Requires active auras to work and<strong> assumes there is a combat active</strong>.<br />Supports the following:</p>\n<ol>\n<li>If a player enters the spirit guardian range on their turn they will save &amp;&amp; take damage.</li>\n<li>At the start of an affected tokens turn they will save &amp;&amp; take damage.</li>\n<li>If they move out of range of the effect they won't take damage anymore.</li>\n<li>All effects removed on expiry/loss of concentration.</li>\n<li>Spell scaling is supported automatically.</li>\n<li>If automated animations, only the initial cast will spawn the animation.</li>\n</ol>",
      "chat": ""
    },
    "source": {
      "custom": "PHB pg. 278",
      "revision": 1,
      "rules": "2024"
    },
    "activation": {
      "type": "action",
      "condition": "",
      "value": 1
    },
    "duration": {
      "value": "10",
      "units": "minute"
    },
    "target": {
      "affects": {
        "type": "self",
        "choice": false,
        "special": ""
      },
      "template": {
        "units": "",
        "contiguous": false,
        "type": ""
      }
    },
    "range": {
      "units": "self",
      "special": ""
    },
    "uses": {
      "max": "",
      "spent": 0,
      "recovery": []
    },
    "ability": "",
    "level": 3,
    "school": "con",
    "materials": {
      "value": "A holy symbol",
      "consumed": false,
      "cost": 0,
      "supply": 0
    },
    "preparation": {
      "mode": "prepared",
      "prepared": false
    },
    "activities": {
      "dnd5eactivity000": {
        "_id": "dnd5eactivity000",
        "type": "utility",
        "activation": {
          "type": "action",
          "value": null,
          "override": false
        },
        "consumption": {
          "targets": [],
          "scaling": {
            "allowed": false,
            "max": ""
          },
          "spellSlot": true
        },
        "description": {
          "chatFlavor": ""
        },
        "duration": {
          "units": "inst",
          "concentration": false,
          "override": false
        },
        "effects": [
          {
            "_id": "kJdmHhTJH03zJxo2"
          }
        ],
        "range": {
          "override": false
        },
        "target": {
          "prompt": true,
          "template": {
            "contiguous": false,
            "units": "ft"
          },
          "affects": {
            "choice": false
          },
          "override": false
        },
        "uses": {
          "spent": 0,
          "max": "",
          "recovery": []
        },
        "roll": {
          "formula": "",
          "name": "",
          "prompt": false,
          "visible": false
        },
        "sort": 0,
        "useConditionText": "",
        "effectConditionText": "",
        "macroData": {
          "name": "",
          "command": ""
        },
        "ignoreTraits": {
          "idi": false,
          "idr": false,
          "idv": false,
          "ida": false
        },
        "midiProperties": {
          "forceDialog": false,
          "confirmTargets": "default",
          "automationOnly": false,
          "identifier": ""
        }
      }
    },
    "identifier": "spirit-guardians-10010",
    "properties": [],
    "sourceClass": "ranger"
  },
  "_stats": {
    "compendiumSource": "Compendium.dnd5e.spells.uCud2s4TjMfjiXUb",
    "duplicateSource": null,
    "coreVersion": "12.331",
    "systemId": "dnd5e",
    "systemVersion": "4.1.2",
    "createdTime": 1734180122481,
    "modifiedTime": 1734180122481,
    "lastModifiedBy": "Zl1BOUaPLwDEujaL"
  },
  "folder": "qF3UYnzAAbVavYSR",
  "_id": "cQRmwQcPULIjCach",
  "sort": 800000,
  "ownership": {
    "default": 0,
    "Zl1BOUaPLwDEujaL": 3
  },
  "_key": "!items!cQRmwQcPULIjCach"
}
